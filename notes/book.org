#+TITLE: lua internals guide
#+AUTHOR: DreamAndDead
#+DESCRIPTION: a guide for reading lua source code
#+DATE: 2020-11-19

#+LATEX_CLASS: book


* overview

章节内容
- 模块的实现原理
- 图解关键数据结构
- 图解关键实现过程
- 非核心部分作为章节阅读任务

#+INCLUDE: "./overview.org"
  
* a small example

把编程语言也看作一个程序，接收源码字符串，并实现约定描述的功能
from source code to result

graph it!

sample code

from start to result

the whole process

* how to read

** source structure

lua source itself

reading project how to use

where I modified the source code


** toolchain

gcc

gdb

gdb script

* object

lobject.c

lua 基础的 8 种数据类型

** nil

** bool

** number

** string

lstring.c

** table

ltable.c
ltm.c

hash
array

metatable

** function

lfunc.c

c func

lua func (closure?)

** userdata

c memory


light

heavy

** thread

later

* memory

lmem.c

* compiler

** lexer

llex.c

*** token

*** regex & DFA & NFA

*** lexstate

zio.c

zio

mbuffer

lexstate

*** token with gdb script (practice)

** parser

lparser.c

*** EBNF

*** LL(1)

*** caveats

binop 优先级

没有按照 EBNF 来命名

** bytecode

lopcodes.c

opcode and oprand

*** proto

*** dump & undump

ldump.c
lundump.c

** generate

lcode.c

*** opcode detail

*** var type (local upval global)

*** allocate stack for local var

*** key statement insight

**** for
     
blockCnt

do end block and break

chunk is not block
    
**** function

upval


* interprete

** vm

lstate.c
lvm.c

*** closure

*** lua_State

*** callinfo

*** stack

*** upval

open and close

** thread (coroutine)

** c api

lapi.c

c <-> stack <-> lua

*** c & stack

*** lua & stack

* gc

lgc.c

** gc object

** algorithm

* debug

ldebug.c

hooks

* package module

lauxlib.c
linit.c

** std lib

lbaselib.c

ldblib.c

liolib.c
lmathlib.c
loslib.c
lstrlib.c

ltablib.c


** dynamic load

loadlib.c


* error handling


ldo.c


- protected call
- longjump





* conf

llimits.c

luaconf.c

* lua standalone interpreter

lua.c

* lua compiler

luac.c
print.c
